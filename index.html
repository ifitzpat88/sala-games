<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Sala Arcade - Family Game Portal</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
:root{
  --bg:#0f0f1a;
  --card:#1a1a2e;
  --card-hover:#222240;
  --border:#2a2a4a;
  --accent:#7c3aed;
  --accent2:#a855f7;
  --cyan:#06b6d4;
  --green:#10b981;
  --pink:#ec4899;
  --orange:#f59e0b;
  --red:#ef4444;
  --blue:#3b82f6;
  --text:#e2e8f0;
  --text-dim:#64748b;
  --text-bright:#f8fafc;
  --glow-purple:rgba(124,58,237,.3);
  --glow-cyan:rgba(6,182,212,.3);
}
html,body{
  min-height:100vh;
  font-family:'Segoe UI','Helvetica Neue',Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* ========== STARS BACKGROUND ========== */
body::before{
  content:'';position:fixed;top:0;left:0;width:100%;height:100%;
  background:
    radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.4) 50%, transparent 50%),
    radial-gradient(1px 1px at 30% 60%, rgba(255,255,255,.3) 50%, transparent 50%),
    radial-gradient(1px 1px at 50% 10%, rgba(255,255,255,.5) 50%, transparent 50%),
    radial-gradient(1px 1px at 70% 40%, rgba(255,255,255,.3) 50%, transparent 50%),
    radial-gradient(1px 1px at 80% 80%, rgba(255,255,255,.4) 50%, transparent 50%),
    radial-gradient(1px 1px at 90% 15%, rgba(255,255,255,.3) 50%, transparent 50%),
    radial-gradient(1px 1px at 15% 85%, rgba(255,255,255,.5) 50%, transparent 50%),
    radial-gradient(1px 1px at 45% 75%, rgba(255,255,255,.2) 50%, transparent 50%),
    radial-gradient(1.5px 1.5px at 25% 45%, rgba(255,255,255,.6) 50%, transparent 50%),
    radial-gradient(1.5px 1.5px at 65% 25%, rgba(255,255,255,.4) 50%, transparent 50%),
    radial-gradient(1.5px 1.5px at 85% 55%, rgba(255,255,255,.5) 50%, transparent 50%),
    radial-gradient(1px 1px at 55% 90%, rgba(255,255,255,.3) 50%, transparent 50%);
  z-index:0;pointer-events:none;
}

/* ========== PAGE LAYOUT (sidebar + main) ========== */
.page-layout{
  display:flex;gap:0;min-height:100vh;position:relative;z-index:1;
}

/* ========== SIDEBAR ========== */
.sidebar{
  width:72px;min-height:100vh;
  background:rgba(15,15,26,.95);
  border-right:1px solid var(--border);
  display:flex;flex-direction:column;align-items:center;
  padding:16px 0;gap:6px;
  position:fixed;left:0;top:0;z-index:10;
}
.sidebar-label{
  font-size:.5rem;font-weight:700;text-transform:uppercase;
  letter-spacing:1px;color:var(--text-dim);
  margin-bottom:8px;writing-mode:horizontal-tb;
}
.sidebar-divider{
  width:40px;height:1px;background:var(--border);margin:4px 0;
}
.sidebar-player{
  width:56px;height:64px;
  background:var(--card);border:2px solid var(--border);
  border-radius:12px;cursor:pointer;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:2px;transition:all .25s;position:relative;
}
.sidebar-player:hover{
  border-color:var(--accent);
  transform:scale(1.08);
  box-shadow:0 0 16px var(--glow-purple);
}
.sidebar-player .animal{font-size:1.5rem;line-height:1;}
.sidebar-player .name{
  font-size:.55rem;font-weight:700;color:var(--text-dim);
  text-transform:uppercase;letter-spacing:.5px;
}
.sidebar-player:hover .name{color:var(--text);}
.sidebar-player.has-unread::after{
  content:'';position:absolute;top:4px;right:4px;
  width:8px;height:8px;border-radius:50%;
  background:var(--green);box-shadow:0 0 6px var(--green);
}
.sidebar-msg-icon{
  margin-top:auto;margin-bottom:8px;
  font-size:1.2rem;opacity:.3;
}

/* ========== MAIN CONTENT ========== */
.main-content{
  flex:1;margin-left:72px;
}
.container{
  max-width:900px;margin:0 auto;padding:20px 16px 40px;
  position:relative;z-index:1;
}

/* ========== HEADER ========== */
.header{text-align:center;padding:30px 0 20px;}
.header-icon{
  font-size:3.5rem;margin-bottom:8px;
  animation:float 3s ease-in-out infinite;
}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.header h1{
  font-size:clamp(1.8rem,5vw,2.8rem);
  font-weight:900;letter-spacing:1px;
  background:linear-gradient(135deg,var(--accent2),var(--cyan),var(--pink));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.header .tagline{
  color:var(--text-dim);font-size:.95rem;margin-top:6px;
  letter-spacing:.5px;
}

/* ========== PLAYER FILTER ========== */
.filter-bar{
  display:flex;flex-wrap:wrap;gap:8px;justify-content:center;
  margin:20px 0 24px;
}
.filter-btn{
  padding:8px 18px;font-size:.8rem;font-weight:600;
  background:var(--card);border:1px solid var(--border);
  color:var(--text-dim);border-radius:20px;cursor:pointer;
  transition:all .2s;font-family:inherit;
}
.filter-btn:hover{border-color:var(--accent);color:var(--text);}
.filter-btn.active{
  background:var(--accent);border-color:var(--accent);
  color:white;box-shadow:0 0 15px var(--glow-purple);
}

/* ========== GAME GRID ========== */
.game-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:16px;
}

/* ========== GAME CARD ========== */
.game-card{
  background:var(--card);border:1px solid var(--border);
  border-radius:16px;overflow:hidden;
  transition:all .25s;cursor:pointer;
  position:relative;
  text-decoration:none;color:inherit;
  display:flex;flex-direction:column;
}
.game-card:hover{
  transform:translateY(-4px);
  border-color:var(--accent);
  box-shadow:0 8px 30px rgba(0,0,0,.4),0 0 20px var(--glow-purple);
}
.game-card:active{transform:translateY(-2px);}

.card-banner{
  height:100px;display:flex;align-items:center;justify-content:center;
  font-size:3rem;position:relative;overflow:hidden;
}
.card-banner::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:30px;
  background:linear-gradient(transparent,var(--card));
}

.card-body{padding:14px 16px 16px;flex:1;display:flex;flex-direction:column;}
.card-title{font-size:1.05rem;font-weight:700;color:var(--text-bright);margin-bottom:4px;}
.card-desc{font-size:.78rem;color:var(--text-dim);line-height:1.4;flex:1;}
.card-footer{
  display:flex;align-items:center;justify-content:space-between;
  margin-top:10px;padding-top:10px;border-top:1px solid var(--border);
}
.card-player{
  display:flex;align-items:center;gap:6px;
  font-size:.75rem;font-weight:600;
}
.player-dot{
  width:8px;height:8px;border-radius:50%;
  display:inline-block;
}
.card-tag{
  font-size:.65rem;font-weight:600;
  padding:3px 10px;border-radius:10px;
  text-transform:uppercase;letter-spacing:.5px;
}

/* Player colors */
.color-arliss{background:var(--green);}
.color-austyn{background:var(--cyan);}
.color-cash{background:var(--orange);}
.color-heather{background:var(--pink);}
.color-el-padre{background:var(--accent);}
.color-bob{background:var(--red);}
.color-claude{background:#3b82f6;}

.tag-survival{background:rgba(239,68,68,.15);color:#f87171;}
.tag-creative{background:rgba(6,182,212,.15);color:#22d3ee;}
.tag-action{background:rgba(245,158,11,.15);color:#fbbf24;}
.tag-simulation{background:rgba(16,185,129,.15);color:#34d399;}
.tag-puzzle{background:rgba(124,58,237,.15);color:#a78bfa;}
.tag-adventure{background:rgba(236,72,153,.15);color:#f472b6;}
.tag-flight{background:rgba(59,130,246,.15);color:#60a5fa;}

/* ========== FOOTER ========== */
.footer{
  text-align:center;margin-top:40px;padding:20px;
  color:var(--text-dim);font-size:.75rem;
  border-top:1px solid var(--border);
}
.footer a{color:var(--accent2);text-decoration:none;}

/* ========== MESSAGE MODAL ========== */
.modal-overlay{
  display:none;position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,.7);backdrop-filter:blur(4px);
  z-index:100;align-items:center;justify-content:center;
}
.modal-overlay.open{display:flex;}
.modal{
  background:var(--card);border:1px solid var(--border);
  border-radius:20px;padding:32px;
  width:90%;max-width:420px;
  box-shadow:0 20px 60px rgba(0,0,0,.6),0 0 40px var(--glow-purple);
  animation:modalIn .3s ease;
}
@keyframes modalIn{from{opacity:0;transform:scale(.9) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}

.modal-header{
  display:flex;align-items:center;gap:12px;margin-bottom:20px;
}
.modal-animal{font-size:2.5rem;}
.modal-title{font-size:1.2rem;font-weight:800;color:var(--text-bright);}
.modal-subtitle{font-size:.75rem;color:var(--text-dim);}

.modal-close{
  position:absolute;top:16px;right:20px;
  background:none;border:none;color:var(--text-dim);
  font-size:1.5rem;cursor:pointer;transition:color .2s;
}
.modal-close:hover{color:var(--text);}

/* Password step */
.modal-step{display:none;}
.modal-step.active{display:block;}

.modal-input{
  width:100%;padding:12px 16px;
  background:var(--bg);border:1px solid var(--border);
  border-radius:12px;color:var(--text);
  font-size:.95rem;font-family:inherit;
  outline:none;transition:border-color .2s;
}
.modal-input:focus{border-color:var(--accent);}
.modal-input::placeholder{color:var(--text-dim);}

textarea.modal-input{
  min-height:120px;resize:vertical;line-height:1.5;
}

.modal-btn{
  width:100%;padding:12px;margin-top:12px;
  background:var(--accent);border:none;
  border-radius:12px;color:white;
  font-size:.9rem;font-weight:700;font-family:inherit;
  cursor:pointer;transition:all .2s;
}
.modal-btn:hover{background:var(--accent2);box-shadow:0 0 20px var(--glow-purple);}
.modal-btn:disabled{opacity:.5;cursor:not-allowed;}

.modal-error{
  color:var(--red);font-size:.8rem;margin-top:8px;
  display:none;
}
.modal-error.show{display:block;}

.modal-hint{
  color:var(--text-dim);font-size:.7rem;margin-top:8px;
  text-align:center;
}

/* Success state */
.modal-success{
  text-align:center;padding:20px 0;
}
.modal-success .check{font-size:3rem;margin-bottom:12px;}
.modal-success h3{color:var(--green);font-size:1.1rem;margin-bottom:8px;}
.modal-success p{color:var(--text-dim);font-size:.85rem;line-height:1.5;}

/* Message history */
.msg-history{
  margin-top:16px;padding-top:16px;border-top:1px solid var(--border);
}
.msg-history-title{
  font-size:.7rem;font-weight:700;text-transform:uppercase;
  letter-spacing:1px;color:var(--text-dim);margin-bottom:8px;
}
.msg-history-list{
  max-height:150px;overflow-y:auto;
  display:flex;flex-direction:column;gap:6px;
}
.msg-history-item{
  font-size:.75rem;color:var(--text-dim);
  padding:8px 10px;background:var(--bg);
  border-radius:8px;line-height:1.4;
}
.msg-history-item .msg-date{
  font-size:.6rem;color:var(--accent2);
  display:block;margin-bottom:2px;
}

/* ========== RESPONSIVE ========== */
@media(max-width:600px){
  .sidebar{
    width:100%;min-height:auto;height:auto;
    flex-direction:row;position:fixed;bottom:0;top:auto;
    border-right:none;border-top:1px solid var(--border);
    padding:8px 16px;justify-content:center;gap:16px;
  }
  .sidebar-label,.sidebar-divider,.sidebar-msg-icon{display:none;}
  .sidebar-player{width:60px;height:52px;flex-direction:row;gap:6px;}
  .sidebar-player .animal{font-size:1.2rem;}
  .sidebar-player .name{font-size:.6rem;}
  .main-content{margin-left:0;margin-bottom:68px;}
  .game-grid{grid-template-columns:1fr;}
  .card-banner{height:80px;font-size:2.5rem;}
}
</style>
</head>
<body>

<div class="page-layout">

  <!-- ===== SIDEBAR: Message Ian ===== -->
  <div class="sidebar">
    <div class="sidebar-label">MSG</div>
    <div class="sidebar-divider"></div>

    <div class="sidebar-player" onclick="openModal('cash')" title="Message Ian as Cash">
      <div class="animal">üêï</div>
      <div class="name">Cash</div>
    </div>

    <div class="sidebar-player" onclick="openModal('austyn')" title="Message Ian as Austyn">
      <div class="animal">üê±</div>
      <div class="name">Austyn</div>
    </div>

    <div class="sidebar-player" onclick="openModal('arliss')" title="Message Ian as Arliss">
      <div class="animal">ü¶Å</div>
      <div class="name">Arliss</div>
    </div>

    <div class="sidebar-msg-icon">‚úâÔ∏è</div>
  </div>

  <!-- ===== MAIN CONTENT ===== -->
  <div class="main-content">
    <div class="container">

      <div class="header">
        <div class="header-icon">üéÆ</div>
        <h1>SALA ARCADE</h1>
        <div class="tagline">Family Game Portal</div>
      </div>

      <div class="filter-bar" id="filter-bar">
        <button class="filter-btn active" data-filter="all" onclick="filterGames('all',this)">All Games</button>
        <button class="filter-btn" data-filter="arliss" onclick="filterGames('arliss',this)">üü¢ Arliss</button>
        <button class="filter-btn" data-filter="austyn" onclick="filterGames('austyn',this)">üîµ Austyn</button>
        <button class="filter-btn" data-filter="cash" onclick="filterGames('cash',this)">üü† Cash</button>
        <button class="filter-btn" data-filter="heather" onclick="filterGames('heather',this)">ü©∑ Heather</button>
        <button class="filter-btn" data-filter="el-padre" onclick="filterGames('el-padre',this)">üü£ El Padre</button>
        <button class="filter-btn" data-filter="claude" onclick="filterGames('claude',this)">üî∑ Claude</button>
      </div>

      <div class="game-grid" id="game-grid"></div>

      <div class="footer">
        Sala Arcade &mdash; Built with love by the family<br>
        Powered by HTML5, CSS, JavaScript &amp; imagination
      </div>
    </div>
  </div>
</div>

<!-- ===== MESSAGE MODAL ===== -->
<div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this)closeModal()">
  <div class="modal" style="position:relative;">
    <button class="modal-close" onclick="closeModal()">&times;</button>

    <div class="modal-header">
      <div class="modal-animal" id="modal-animal"></div>
      <div>
        <div class="modal-title" id="modal-title"></div>
        <div class="modal-subtitle">Send a message to Ian</div>
      </div>
    </div>

    <!-- Step 1: Password -->
    <div class="modal-step active" id="step-password">
      <input type="password" class="modal-input" id="password-input"
        placeholder="Enter your secret password..."
        onkeydown="if(event.key==='Enter')checkPassword()">
      <button class="modal-btn" onclick="checkPassword()">Unlock</button>
      <div class="modal-error" id="password-error">Wrong password! Try again.</div>
      <div class="modal-hint">Hint: your animal + your name (lowercase)</div>
    </div>

    <!-- Step 2: Message -->
    <div class="modal-step" id="step-message">
      <textarea class="modal-input" id="message-input"
        placeholder="What game updates or ideas do you want to tell Ian about?"></textarea>
      <button class="modal-btn" id="send-btn" onclick="sendMessage()">Send to Ian</button>

      <!-- Past messages -->
      <div class="msg-history" id="msg-history" style="display:none;">
        <div class="msg-history-title">Your sent messages</div>
        <div class="msg-history-list" id="msg-history-list"></div>
      </div>
    </div>

    <!-- Step 3: Success -->
    <div class="modal-step" id="step-success">
      <div class="modal-success">
        <div class="check">‚úÖ</div>
        <h3>Message sent!</h3>
        <p>Ian will see your message soon.<br>Keep playing and have fun!</p>
      </div>
      <button class="modal-btn" onclick="closeModal()" style="background:var(--green);">Back to Games</button>
    </div>

  </div>
</div>

<script>
/* ========== GAMES DATA ========== */
const GAMES = [
  {
    title: 'Camp Cretaceous: Protocol Survival',
    desc: 'Survive on Isla Nublar! Choose your Camp Fam operative, scavenge Main Street, battle dinosaurs with SVG visuals, and activate the emergency beacon before it\'s too late.',
    emoji: 'ü¶ñ',
    banner: 'linear-gradient(135deg, #0a1f10, #1a3a2a)',
    url: 'arliss/index.html',
    player: 'Arliss',
    playerColor: 'color-arliss',
    tag: 'Survival',
    tagClass: 'tag-survival',
  },
  {
    title: 'Spin-a-Life: World Edition',
    desc: 'Create a passport, spin the wheel to find your town, build a house, train at the gym with mini-games, get a job, buy pets and become an astronaut!',
    emoji: 'üåç',
    banner: 'linear-gradient(135deg, #1a3a5c, #2a5a8c)',
    url: 'austyn/spin-a-life.html',
    player: 'Austyn',
    playerColor: 'color-austyn',
    tag: 'Simulation',
    tagClass: 'tag-simulation',
  },
  {
    title: 'Austyn\'s Cursive Studio',
    desc: 'Learn and practice cursive handwriting with guided letter tracing, different fonts, and a creative free-draw canvas.',
    emoji: '‚úçÔ∏è',
    banner: 'linear-gradient(135deg, #2a1a3a, #4a2a6a)',
    url: 'austyn/index.html',
    player: 'Austyn',
    playerColor: 'color-austyn',
    tag: 'Creative',
    tagClass: 'tag-creative',
  },
  {
    title: 'AVATAR: Dinosaur Adventure',
    desc: 'Explore a prehistoric world as Austyn\'s custom avatar. Discover dinosaurs, collect items, and survive in this adventure game.',
    emoji: 'ü¶ï',
    banner: 'linear-gradient(135deg, #0a2a1a, #1a4a3a)',
    url: 'austyn-avatar/index.html',
    player: 'Austyn',
    playerColor: 'color-austyn',
    tag: 'Adventure',
    tagClass: 'tag-adventure',
  },
  {
    title: 'Austyn Takes Flight',
    desc: 'Soar through the skies in this flying game! Dodge obstacles and see how far you can go.',
    emoji: '‚úàÔ∏è',
    banner: 'linear-gradient(135deg, #1a2a4a, #2a4a7a)',
    url: 'austyn-avatar/fly.html',
    player: 'Austyn',
    playerColor: 'color-austyn',
    tag: 'Flight',
    tagClass: 'tag-flight',
  },
  {
    title: 'Cash\'s Dino Arena',
    desc: 'Command dinosaurs in fast-paced arena combat! Pick your fighter and battle for supremacy.',
    emoji: '‚öîÔ∏è',
    banner: 'linear-gradient(135deg, #3a1a0a, #5a2a1a)',
    url: 'cash/index.html',
    player: 'Cash',
    playerColor: 'color-cash',
    tag: 'Action',
    tagClass: 'tag-action',
  },
  {
    title: 'Portal Knights: Shattered Isles',
    desc: 'Explore island biomes, gather resources, craft tools, build houses with chimneys, farm crops, fight monsters, and level up your character across 4 portal-linked worlds.',
    emoji: 'ü™ê',
    banner: 'linear-gradient(135deg, #1a0a3a, #2a1a5a)',
    url: 'cash/portal-knights.html',
    player: 'Cash',
    playerColor: 'color-cash',
    tag: 'Adventure',
    tagClass: 'tag-adventure',
  },
  {
    title: 'Energy Siege: Overload',
    desc: 'A strategic energy management game. Build defenses, manage power, and survive the siege!',
    emoji: '‚ö°',
    banner: 'linear-gradient(135deg, #2a2a0a, #4a4a1a)',
    url: 'cash/energy-siege.html',
    player: 'Cash',
    playerColor: 'color-cash',
    tag: 'Action',
    tagClass: 'tag-action',
  },
  {
    title: 'Bob\'s Arena',
    desc: 'Enter Bob\'s fighting arena! Battle opponents in this action-packed brawler.',
    emoji: 'ü•ä',
    banner: 'linear-gradient(135deg, #3a0a0a, #5a1a1a)',
    url: 'bobs_arena/index.html',
    player: 'Cash',
    playerColor: 'color-cash',
    tag: 'Action',
    tagClass: 'tag-action',
  },
  {
    title: 'The Swordsman',
    desc: 'A knight\'s epic journey! Wield sword, shield & bow across 5 worlds ‚Äî forest, desert, ice, volcano & a dragon boss castle. Mario meets Castlevania.',
    emoji: '‚öîÔ∏è',
    banner: 'linear-gradient(135deg, #1a2a4a, #3a4a2a)',
    url: 'cash/swordman.html',
    player: 'Cash',
    playerColor: 'color-cash',
    tag: 'Adventure',
    tagClass: 'tag-adventure',
  },
  {
    title: 'BOXMANIA',
    desc: 'Retro arcade boxing! Pick your race and fighting style, then go toe-to-toe in the ring. Aim high or low, block smart, and score the K.O.',
    emoji: 'ü•ã',
    banner: 'linear-gradient(135deg, #3a2a0a, #5a3a0a)',
    url: 'cash/boxmania.html',
    player: 'Cash',
    playerColor: 'color-cash',
    tag: 'Action',
    tagClass: 'tag-action',
  },
  {
    title: 'Alone',
    desc: 'First-person survival! Explore 5 biomes, mine ores underground, craft tools & weapons, build structures & wells, and tame dinosaurs & fantasy creatures.',
    emoji: 'üèîÔ∏è',
    banner: 'linear-gradient(135deg, #2a3a1a, #4a5a2a)',
    url: 'cash/primal-frontier.html',
    player: 'Cash',
    playerColor: 'color-cash',
    tag: 'Survival',
    tagClass: 'tag-survival',
  },
  {
    title: 'Country Barrel: Heather\'s Shift',
    desc: 'Run a country diner! Take orders, cook food, and keep customers happy in this restaurant sim with Food Fu combat.',
    emoji: 'üçΩÔ∏è',
    banner: 'linear-gradient(135deg, #3a1a2a, #5a2a4a)',
    url: 'heather/index.html',
    player: 'Heather',
    playerColor: 'color-heather',
    tag: 'Simulation',
    tagClass: 'tag-simulation',
  },
  {
    title: 'Country Barrel: Heather Takes Flight',
    desc: 'Heather takes to the skies! A flying adventure game with country charm.',
    emoji: 'üõ©Ô∏è',
    banner: 'linear-gradient(135deg, #2a1a3a, #4a2a5a)',
    url: 'heather/fly.html',
    player: 'Heather',
    playerColor: 'color-heather',
    tag: 'Flight',
    tagClass: 'tag-flight',
  },
  {
    title: 'ORBIT',
    desc: 'A gravitational slingshot puzzle. Place planets to bend spacetime and guide your ship to the portal across 10 hand-crafted levels.',
    emoji: 'ü™ê',
    banner: 'linear-gradient(135deg, #0a0e2e, #1a2a5a)',
    url: 'claude/orbit.html',
    player: 'Claude',
    playerColor: 'color-claude',
    tag: 'Puzzle',
    tagClass: 'tag-puzzle',
  },
  {
    title: 'El Padre\'s Tetris',
    desc: 'The classic block-stacking puzzle game! Clear lines, rack up points, and see how long Dad can last.',
    emoji: 'üß±',
    banner: 'linear-gradient(135deg, #1a1a3a, #2a2a5a)',
    url: 'el-padre/index.html',
    player: 'El Padre',
    playerColor: 'color-el-padre',
    tag: 'Puzzle',
    tagClass: 'tag-puzzle',
  },
];

/* ========== GAME RENDERING ========== */
function renderGames(filter){
  const grid = document.getElementById('game-grid');
  const filtered = filter==='all' ? GAMES : GAMES.filter(g=>g.player.toLowerCase().replace(' ','-')===filter || g.playerColor.replace('color-','')===filter);
  grid.innerHTML = '';
  filtered.forEach(g=>{
    const card = document.createElement('a');
    card.className = 'game-card';
    card.href = g.url;
    card.innerHTML = `
      <div class="card-banner" style="background:${g.banner}">
        ${g.emoji}
      </div>
      <div class="card-body">
        <div class="card-title">${g.title}</div>
        <div class="card-desc">${g.desc}</div>
        <div class="card-footer">
          <div class="card-player">
            <span class="player-dot ${g.playerColor}"></span>
            ${g.player}
          </div>
          <div class="card-tag ${g.tagClass}">${g.tag}</div>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
}

function filterGames(filter, btn){
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderGames(filter);
}

/* ========== MESSAGE SYSTEM ========== */
const PLAYERS = {
  cash:   { name: 'Cash',   animal: 'üêï', password: 'dogcash',     color: 'var(--orange)' },
  austyn: { name: 'Austyn', animal: 'üê±', password: 'cataustyn',   color: 'var(--cyan)' },
  arliss: { name: 'Arliss', animal: 'ü¶Å', password: 'lionarliss',  color: 'var(--green)' },
};

const NTFY_TOPIC = 'sala-arcade-fitz-oklahoma';
let currentPlayer = null;

function openModal(playerId) {
  currentPlayer = PLAYERS[playerId];
  currentPlayer.id = playerId;

  document.getElementById('modal-animal').textContent = currentPlayer.animal;
  document.getElementById('modal-title').textContent = currentPlayer.name + "'s Message Box";

  // Reset to password step
  document.querySelectorAll('.modal-step').forEach(s => s.classList.remove('active'));
  document.getElementById('step-password').classList.add('active');
  document.getElementById('password-input').value = '';
  document.getElementById('message-input').value = '';
  document.getElementById('password-error').classList.remove('show');

  document.getElementById('modal-overlay').classList.add('open');
  setTimeout(() => document.getElementById('password-input').focus(), 100);
}

function closeModal() {
  document.getElementById('modal-overlay').classList.remove('open');
  currentPlayer = null;
}

function checkPassword() {
  const input = document.getElementById('password-input').value.trim().toLowerCase();
  if (input === currentPlayer.password) {
    // Go to message step
    document.querySelectorAll('.modal-step').forEach(s => s.classList.remove('active'));
    document.getElementById('step-message').classList.add('active');
    setTimeout(() => document.getElementById('message-input').focus(), 100);
    renderHistory();
  } else {
    document.getElementById('password-error').classList.add('show');
    document.getElementById('password-input').value = '';
    document.getElementById('password-input').focus();
    // Shake animation
    const modal = document.querySelector('.modal');
    modal.style.animation = 'none';
    modal.offsetHeight; // trigger reflow
    modal.style.animation = 'shake .4s ease';
  }
}

async function sendMessage() {
  const msg = document.getElementById('message-input').value.trim();
  if (!msg) return;

  const btn = document.getElementById('send-btn');
  btn.disabled = true;
  btn.textContent = 'Sending...';

  // Save to localStorage
  const key = 'sala_messages_' + currentPlayer.id;
  const messages = JSON.parse(localStorage.getItem(key) || '[]');
  const entry = {
    text: msg,
    date: new Date().toISOString(),
    player: currentPlayer.name,
  };
  messages.unshift(entry);
  localStorage.setItem(key, JSON.stringify(messages));

  // Send to ntfy.sh
  try {
    await fetch('https://ntfy.sh/' + NTFY_TOPIC, {
      method: 'POST',
      headers: { 'Title': currentPlayer.animal + ' ' + currentPlayer.name + ' - Sala Arcade' },
      body: currentPlayer.animal + ' ' + currentPlayer.name + ' says:\n\n' + msg,
    });
  } catch (e) {
    // Offline? Message is still saved locally
    console.log('ntfy send failed (offline?), message saved locally');
  }

  // Show success
  btn.disabled = false;
  btn.textContent = 'Send to Ian';
  document.querySelectorAll('.modal-step').forEach(s => s.classList.remove('active'));
  document.getElementById('step-success').classList.add('active');
}

function renderHistory() {
  if (!currentPlayer) return;
  const key = 'sala_messages_' + currentPlayer.id;
  const messages = JSON.parse(localStorage.getItem(key) || '[]');

  const container = document.getElementById('msg-history');
  const list = document.getElementById('msg-history-list');

  if (messages.length === 0) {
    container.style.display = 'none';
    return;
  }

  container.style.display = 'block';
  list.innerHTML = '';
  messages.slice(0, 10).forEach(m => {
    const item = document.createElement('div');
    item.className = 'msg-history-item';
    const d = new Date(m.date);
    const dateStr = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
      + ' ' + d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
    item.innerHTML = '<span class="msg-date">' + dateStr + '</span>' + m.text;
    list.appendChild(item);
  });
}

/* Shake keyframe for wrong password */
const shakeStyle = document.createElement('style');
shakeStyle.textContent = '@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-10px)}40%{transform:translateX(10px)}60%{transform:translateX(-6px)}80%{transform:translateX(6px)}}';
document.head.appendChild(shakeStyle);

// Escape key closes modal
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

// Init
renderGames('all');
</script>
</body>
</html>